@using System.Net.Http
@inject HttpClient Http

@page "/spacex"

<h1>SpaceX</h1>

<div>
    <h3>Launches</h3>

    <button class="btn text-light m-1 @((VisibleLaunches == UpcomingLaunches && UpcomingLaunches != null) ? "btn-primary" : "")" @onclick="(() => VisibleLaunches = UpcomingLaunches)">Upcoming Launches</button>

    <button class="btn text-light m-1 @((VisibleLaunches == PastLaunches && PastLaunches != null) ? "btn-primary" : "")" @onclick="(() => VisibleLaunches = PastLaunches)">Past Launches</button>


    @if (!(UpcomingLaunches is null))
    {
        foreach (SpacexLaunch launch in VisibleLaunches)
        {
            <div class="card-body m-1 background-medium rounded">
                <h5 class="card-title">@launch.mission_name</h5>
                <p class="card-text">
                    Launch Date: @launch.launch_date_utc.ToString("dddd, dd MMMM yyyy HH:mm:ss") UTC<br />
                    Vehicle: @launch.rocket.rocket_name
                </p>
            </div>
        }
    }

</div>


@code {

    public const string NextLaunchURI = "https://api.spacexdata.com/v3/launches/next";
    public const string PastLaunchesURI = "https://api.spacexdata.com/v3/launches/past";
    public const string UpcomingLaunchesURI = "https://api.spacexdata.com/v3/launches/upcoming";

    public static SpacexLaunch[] VisibleLaunches;
    public static SpacexLaunch[] PastLaunches;
    public static SpacexLaunch[] UpcomingLaunches;

    protected override async Task OnInitializedAsync()
    {
        if (UpcomingLaunches is null || PastLaunches is null)
        {
            Task<SpacexLaunch[]> PastLaunchesTask = Http.GetJsonAsync<SpacexLaunch[]>(PastLaunchesURI);
            Task<SpacexLaunch[]> UpcomingLaunchesTask = Http.GetJsonAsync<SpacexLaunch[]>(UpcomingLaunchesURI);

            PastLaunches = (await PastLaunchesTask).Reverse().ToArray();
            UpcomingLaunches = await UpcomingLaunchesTask;
            VisibleLaunches = UpcomingLaunches;
        }
        
    }

    public class SpacexLaunch
    {
        public string mission_name { get; set; }
        public DateTime launch_date_utc { get; set; }
        public Rocket rocket { get; set; }

        public class Rocket
        {
            public string rocket_name { get; set; }
        }
    }

}